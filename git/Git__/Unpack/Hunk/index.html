<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Hunk (git.Git__.Unpack.Hunk)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../../index.html">git</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Git__.Unpack.Hunk</span></h1></header><h3 class="heading">Parameters</h3><div><div class="spec argument" id="argument-1-Hash"><a href="#argument-1-Hash" class="anchor"></a><div class="def argument"><code><a href="argument-1-Hash/index.html">Hash</a> : <a href="../../S/index.html#module-type-HASH">Git__.S.HASH</a></code></div><div class="doc"></div></div></div><h3 class="heading">Signature</h3><div class="spec module" id="module-Hash"><a href="#module-Hash" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Hash/index.html">Hash</a> : <a href="../../S/index.html#module-type-HASH">Git__.S.HASH</a></code></div><div class="doc"></div></div><div class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>error</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-error.Reserved_opcode" class="anchored"><td class="def constructor"><a href="#type-error.Reserved_opcode" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Reserved_opcode</span><span class="keyword"> of </span>int</code></td><td class="doc"><p>(** Appear when we catch a reserved opcode. *)</p></td></tr><tr id="type-error.Wrong_copy_hunk" class="anchored"><td class="def constructor"><a href="#type-error.Wrong_copy_hunk" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Wrong_copy_hunk</span><span class="keyword"> of </span>int<span class="keyword"> * </span>int<span class="keyword"> * </span>int</code></td><td class="doc"><p>(** Appear when the <code class="code">Copy</code> hunk refers to a wrong area (because is
bigger than it's possible to store into the target or because it
does not correspond to a valid area from the source). *)</p></td></tr></table><code></code></div><div class="doc"><p>The type error.</p></div></div><div class="spec val" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_error : <a href="index.html#type-error">error</a> Fmt.t</code></div><div class="doc"><p>Pretty-printer of <a href="index.html#type-error">error</a>.</p></div></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-t.i_off" class="anchored"><td class="def field"><a href="#type-t.i_off" class="anchor"></a><code>i_off : int;</code></td></tr><tr id="type-t.i_pos" class="anchored"><td class="def field"><a href="#type-t.i_pos" class="anchor"></a><code>i_pos : int;</code></td></tr><tr id="type-t.i_len" class="anchored"><td class="def field"><a href="#type-t.i_len" class="anchor"></a><code>i_len : int;</code></td></tr><tr id="type-t.read" class="anchored"><td class="def field"><a href="#type-t.read" class="anchor"></a><code>read : int;</code></td></tr><tr id="type-t._length" class="anchored"><td class="def field"><a href="#type-t._length" class="anchor"></a><code>_length : int;</code></td></tr><tr id="type-t._reference" class="anchored"><td class="def field"><a href="#type-t._reference" class="anchor"></a><code>_reference : <a href="index.html#type-reference">reference</a>;</code></td></tr><tr id="type-t._source_length" class="anchored"><td class="def field"><a href="#type-t._source_length" class="anchor"></a><code>_source_length : int;</code></td></tr><tr id="type-t._target_length" class="anchored"><td class="def field"><a href="#type-t._target_length" class="anchor"></a><code>_target_length : int;</code></td></tr><tr id="type-t._hunk" class="anchored"><td class="def field"><a href="#type-t._hunk" class="anchor"></a><code>_hunk : <a href="index.html#type-hunk">hunk</a> option;</code></td></tr><tr id="type-t._tmp" class="anchored"><td class="def field"><a href="#type-t._tmp" class="anchor"></a><code>_tmp : Cstruct.t;</code></td></tr><tr id="type-t.state" class="anchored"><td class="def field"><a href="#type-t.state" class="anchor"></a><code>state : <a href="index.html#type-state">state</a>;</code></td></tr></table><code>}</code><code></code></div><div class="doc"><p>The type of the Hunk decoder.</p></div></div><div class="spec type" id="type-k"><a href="#type-k" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>k</code><code><span class="keyword"> = </span>Cstruct.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-res">res</a></code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-state"><a href="#type-state" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>state</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-state.Header" class="anchored"><td class="def constructor"><a href="#type-state.Header" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Header</span><span class="keyword"> of </span><a href="index.html#type-k">k</a></code></td></tr><tr id="type-state.Stop" class="anchored"><td class="def constructor"><a href="#type-state.Stop" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Stop</span></code></td></tr><tr id="type-state.List" class="anchored"><td class="def constructor"><a href="#type-state.List" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">List</span><span class="keyword"> of </span><a href="index.html#type-k">k</a></code></td></tr><tr id="type-state.Is_insert" class="anchored"><td class="def constructor"><a href="#type-state.Is_insert" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Is_insert</span><span class="keyword"> of </span>Cstruct.t<span class="keyword"> * </span>int<span class="keyword"> * </span>int</code></td></tr><tr id="type-state.Is_copy" class="anchored"><td class="def constructor"><a href="#type-state.Is_copy" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Is_copy</span><span class="keyword"> of </span><a href="index.html#type-k">k</a></code></td></tr><tr id="type-state.End" class="anchored"><td class="def constructor"><a href="#type-state.End" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">End</span></code></td></tr><tr id="type-state.Exception" class="anchored"><td class="def constructor"><a href="#type-state.Exception" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Exception</span><span class="keyword"> of </span><a href="index.html#type-error">error</a></code></td></tr></table><code></code></div><div class="doc"></div></div><div class="spec type" id="type-res"><a href="#type-res" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>res</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-res.Wait" class="anchored"><td class="def constructor"><a href="#type-res.Wait" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Wait</span><span class="keyword"> of </span><a href="index.html#type-t">t</a></code></td></tr><tr id="type-res.Error" class="anchored"><td class="def constructor"><a href="#type-res.Error" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Error</span><span class="keyword"> of </span><a href="index.html#type-t">t</a><span class="keyword"> * </span><a href="index.html#type-error">error</a></code></td></tr><tr id="type-res.Cont" class="anchored"><td class="def constructor"><a href="#type-res.Cont" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Cont</span><span class="keyword"> of </span><a href="index.html#type-t">t</a></code></td></tr><tr id="type-res.Ok" class="anchored"><td class="def constructor"><a href="#type-res.Ok" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Ok</span><span class="keyword"> of </span><a href="index.html#type-t">t</a><span class="keyword"> * </span><a href="index.html#type-hunks">hunks</a></code></td><td class="doc"><p>(** The type of compressed/delta-ified object. *)</p></td></tr></table><code></code></div><div class="doc"></div></div><div class="spec type" id="type-hunk"><a href="#type-hunk" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>hunk</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-hunk.Insert" class="anchored"><td class="def constructor"><a href="#type-hunk.Insert" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Insert</span><span class="keyword"> of </span>Cstruct.t</code></td><td class="doc"><p>(** Raw buffer. *)</p></td></tr><tr id="type-hunk.Copy" class="anchored"><td class="def constructor"><a href="#type-hunk.Copy" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Copy</span><span class="keyword"> of </span>int<span class="keyword"> * </span>int</code></td><td class="doc"><p>(** absolute offset ⨯ length *)</p></td></tr></table><code></code></div><div class="doc"></div></div><div class="spec type" id="type-reference"><a href="#type-reference" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>reference</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-reference.Offset" class="anchored"><td class="def constructor"><a href="#type-reference.Offset" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Offset</span><span class="keyword"> of </span>int64</code></td></tr><tr id="type-reference.Hash" class="anchored"><td class="def constructor"><a href="#type-reference.Hash" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Hash</span><span class="keyword"> of </span><a href="index.html#module-Hash">Hash</a>.t</code></td><td class="doc"><p>(** The type of the Hunk. *)</p></td></tr></table><code></code></div><div class="doc"><p>The type of the reference. It's a negative offset or the hash of the
source object.</p></div></div><div class="spec type" id="type-hunks"><a href="#type-hunks" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>hunks</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-hunks.reference" class="anchored"><td class="def field"><a href="#type-hunks.reference" class="anchor"></a><code>reference : <a href="index.html#type-reference">reference</a>;</code></td><td class="doc"><p>(** Reference to the source. *)</p></td></tr><tr id="type-hunks.length" class="anchored"><td class="def field"><a href="#type-hunks.length" class="anchor"></a><code>length : int;</code></td><td class="doc"><p>(** Inflated length of the serialized Hunk. *)</p></td></tr><tr id="type-hunks.source_length" class="anchored"><td class="def field"><a href="#type-hunks.source_length" class="anchor"></a><code>source_length : int;</code></td><td class="doc"><p>(** Length of the source object. *)</p></td></tr><tr id="type-hunks.target_length" class="anchored"><td class="def field"><a href="#type-hunks.target_length" class="anchor"></a><code>target_length : int;</code></td><td class="doc"><p>(** Expected length of the target object. *)</p></td></tr></table><code>}</code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-partial_hunks"><a href="#val-partial_hunks" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>partial_hunks : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-hunks">hunks</a></code></div><div class="doc"><p><code class="code">partial_hunks t</code> returns a partial hunks to get some available
information. <span class="xref-unresolved" title="unresolved reference to &quot;hunks.hunks&quot;"><a href="index.html#type-hunks">hunks</a>.hunks</span> is not available.</p></div></div><div class="spec val" id="val-pp_reference"><a href="#val-pp_reference" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_reference : <a href="index.html#type-reference">reference</a> Fmt.t</code></div><div class="doc"><p>A pretty-printer of <a href="index.html#type-reference">reference</a>.</p></div></div><div class="spec val" id="val-pp_hunks"><a href="#val-pp_hunks" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_hunks : <a href="index.html#type-hunks">hunks</a> Fmt.t</code></div><div class="doc"><p>A pretty-printer of <a href="index.html#type-hunks">hunks</a>.</p></div></div><div class="spec val" id="val-pp"><a href="#val-pp" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp : <a href="index.html#type-t">t</a> Fmt.t</code></div><div class="doc"><p>Pretty-printer of the decoder <a href="index.html#type-t">t</a>.</p></div></div><div class="spec val" id="val-eval"><a href="#val-eval" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>eval : Cstruct.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> [ `Hunk of <a href="index.html#type-t">t</a><span class="keyword"> * </span><a href="index.html#type-hunk">hunk</a> | `Await of <a href="index.html#type-t">t</a> | `Error of <a href="index.html#type-t">t</a><span class="keyword"> * </span><a href="index.html#type-error">error</a> | `Ok of <a href="index.html#type-t">t</a><span class="keyword"> * </span><a href="index.html#type-hunks">hunks</a> ]</code></div><div class="doc"><p><code class="code">eval src t</code> is:</p><ul><li><code class="code">`Await t</code> iff <code class="code">t</code> needs more input storage. The client must use
<a href="index.html#val-refill">refill</a> to provide a new buffer and then call <a href="index.html#val-eval">eval</a> with <code class="code">`Await</code>
until other value returned.</li><li><code class="code">`Hunk t</code> when <code class="code">t</code> can return a new
<a href="index.html#type-hunk">hunk</a>. The client can call <a href="index.html#val-continue">continue</a> to move to the next step of the
process, otherwise the decode sticks on this situation. The value will be
consumed then. If the <a href="index.html#type-hunk">hunk</a> is <code class="code">Insert</code>, the internal <code class="code">Cstruct.t</code> need
to be copied because <a href="index.html#val-eval">eval</a> will erase the content then.</li><li><code class="code">`Ok (t,
      hunks)</code> when <code class="code">t</code> is done. We returns the complete value <a href="index.html#type-hunks">hunks</a>. Then,
<code class="code">t</code> sticks on this situation, the client can remove it.</li><li><code class="code">`Error (t,
      exn)</code> iff the decoder <code class="code">t</code> meet an <a href="index.html#type-error">error</a><code class="code">exn</code>. The decoder can't
continue and sticks in this situation.</li></ul></div></div><div class="spec val" id="val-default"><a href="#val-default" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>default : int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-reference">reference</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Make a new decoder state <a href="index.html#type-t">t</a> from a <a href="index.html#type-reference">reference</a>. We need to notice the
length of the inflated stream to know when the decoder <a href="index.html#type-t">t</a> is done.</p></div></div><div class="spec val" id="val-refill"><a href="#val-refill" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>refill : int <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">refill off len t</code> provides a new <code class="code">t</code> with <code class="code">len</code> bytes to read, starting
at <code class="code">off</code>. This byte range is read by calls to <a href="index.html#val-eval">eval</a> with <code class="code">t</code> until
<code class="code">`Await</code> is returned.</p></div></div><div class="spec val" id="val-continue"><a href="#val-continue" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>continue : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">continue t</code> provides a new <code class="code">t</code> to move to the next step of the process
and consumes the current <a href="index.html#type-hunk">hunk</a> returned by <a href="index.html#val-eval">eval</a>.</p></div></div><div class="spec val" id="val-current"><a href="#val-current" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>current : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-hunk">hunk</a></code></div><div class="doc"><p><code class="code">current t</code> provides the current <a href="index.html#type-hunk">hunk</a> from the decoder <code class="code">t</code>. This hunk
is equivalent to: <code class="code">eval _ t</code>, which returns <code class="code">`Hunk</code> with the same
(physically) <a href="index.html#type-hunk">hunk</a>.</p><p>You only can call this function when you ensure than <code class="code">eval _ t</code> returns
<code class="code">`Hunk</code>. Otherwise, we raise an exception <code class="code">Invalid_argument</code>.</p></div></div><div class="spec val" id="val-used_in"><a href="#val-used_in" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>used_in : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"><p><code class="code">used_in ŧ</code> returns how many byte <code class="code">t</code> consumed in the current buffer
noticed to the previous call of <a href="index.html#val-eval">eval</a>.</p></div></div><div class="spec val" id="val-available_in"><a href="#val-available_in" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>available_in : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"><p><code class="code">available_in t</code> returns how many byte is available in the current buffer
noticed to the previous call of <a href="index.html#val-eval">eval</a>.</p></div></div><div class="spec val" id="val-read"><a href="#val-read" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>read : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> int</code></div><div class="doc"><p><code class="code">read t</code> returns how many byte <code class="code">t</code> read at the beginning. The client can
assert than <code class="code">read t</code> is equal to <code class="code">length</code> noticed when he make the new
decoder.</p></div></div></body></html>