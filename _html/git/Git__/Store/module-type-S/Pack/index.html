<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Pack (git.Git__.Store.S.Pack)</title><link rel="stylesheet" href="../../../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../../../index.html">git</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Git__.Store.S.Pack</span></h1></header><div class="doc"><p>The <code class="code">Pack</code> module which represents any <i>packed</i> git object available in
the git repository.</p></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code><span class="keyword"> = </span><a href="../RPDec/Object/index.html#type-t">RPDec.Object.t</a></code><code></code></div><div class="doc"><p>The type of the <i>packed</i> Git object.</p></div></div><div class="spec type" id="type-state"><a href="#type-state" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>state</code><code><span class="keyword"> = </span><a href="../index.html#type-t">t</a></code><code></code></div><div class="doc"><p>The type for the state of a Git store.</p></div></div><div class="spec type" id="type-value"><a href="#type-value" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>value</code><code><span class="keyword"> = </span><a href="../Value/index.html#type-t">Value.t</a></code><code></code></div><div class="doc"><p>The type of the Git values.</p></div></div><div class="spec module" id="module-FS"><a href="#module-FS" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="FS/index.html">FS</a> : <a href="../../../S/index.html#module-type-FS">Git__.S.FS</a></code></div><div class="doc"><p>The <code class="code">FS</code> module used to make the implementation.</p></div></div><div class="spec module" id="module-Hash"><a href="#module-Hash" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Hash/index.html">Hash</a> : <a href="../../../S/index.html#module-type-HASH">Git__.S.HASH</a></code></div><div class="doc"><p>The <code class="code">Hash</code> module used to make the implementation.</p></div></div><div class="spec module" id="module-Inflate"><a href="#module-Inflate" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Inflate/index.html">Inflate</a> : <a href="../../../S/index.html#module-type-INFLATE">Git__.S.INFLATE</a></code></div><div class="doc"><p>The <code class="code">Inflate</code> module used to make the implementation.</p></div></div><div class="spec module" id="module-Deflate"><a href="#module-Deflate" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Deflate/index.html">Deflate</a> : <a href="../../../S/index.html#module-type-DEFLATE">Git__.S.DEFLATE</a></code></div><div class="doc"><p>The <code class="code">Deflate</code> module used to make the implementation.</p></div></div><div class="spec module" id="module-HDec"><a href="#module-HDec" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="HDec/index.html">HDec</a> : <a href="../../../../Git/Unpack/index.html#module-type-H">Git.Unpack.H</a><span class="keyword"> with </span><span class="keyword">module </span><a href="../../../../Git/Unpack/module-type-H/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a></code></div><div class="doc"></div></div><div class="spec module" id="module-PDec"><a href="#module-PDec" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="PDec/index.html">PDec</a> : <a href="../../../../Git/Unpack/index.html#module-type-P">Git.Unpack.P</a><span class="keyword"> with </span><span class="keyword">module </span><a href="../../../../Git/Unpack/module-type-P/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Unpack/module-type-P/Inflate/index.html">Inflate</a> := <a href="index.html#module-Inflate">Inflate</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Unpack/module-type-P/Hunk/index.html">Hunk</a> := <a href="index.html#module-HDec">HDec</a></code></div><div class="doc"></div></div><div class="spec module" id="module-RPDec"><a href="#module-RPDec" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="RPDec/index.html">RPDec</a> : <a href="../../../../Git/Unpack/index.html#module-type-D">Git.Unpack.D</a><span class="keyword"> with </span><span class="keyword">module </span><a href="../../../../Git/Unpack/module-type-D/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Unpack/module-type-D/Inflate/index.html">Inflate</a> := <a href="index.html#module-Inflate">Inflate</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Unpack/module-type-D/Hunk/index.html">Hunk</a> := <a href="index.html#module-HDec">HDec</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Unpack/module-type-D/Pack/index.html">Pack</a> := <a href="index.html#module-PDec">PDec</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Unpack/module-type-D/Mapper/index.html">Mapper</a> := <a href="FS/index.html#module-Mapper">FS.Mapper</a></code></div><div class="doc"></div></div><div class="spec module" id="module-PEnc"><a href="#module-PEnc" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="PEnc/index.html">PEnc</a> : <a href="../../../../Git/Pack/index.html#module-type-P">Git.Pack.P</a><span class="keyword"> with </span><span class="keyword">module </span><a href="../../../../Git/Pack/module-type-P/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Pack/module-type-P/Deflate/index.html">Deflate</a> := <a href="index.html#module-Deflate">Deflate</a></code></div><div class="doc"></div></div><div class="spec module" id="module-IDec"><a href="#module-IDec" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="IDec/index.html">IDec</a> : <a href="../../../../Git/Index_pack/index.html#module-type-LAZY">Git.Index_pack.LAZY</a><span class="keyword"> with </span><span class="keyword">module </span><a href="../../../../Git/Index_pack/module-type-LAZY/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a></code></div><div class="doc"></div></div><div class="spec module" id="module-IEnc"><a href="#module-IEnc" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="IEnc/index.html">IEnc</a> : <a href="../../../../Git/Index_pack/index.html#module-type-ENCODER">Git.Index_pack.ENCODER</a><span class="keyword"> with </span><span class="keyword">module </span><a href="../../../../Git/Index_pack/module-type-ENCODER/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a></code></div><div class="doc"></div></div><div class="spec module" id="module-PInfo"><a href="#module-PInfo" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="PInfo/index.html">PInfo</a> : <a href="../../../../Git/Pack_info/index.html#module-type-S">Git.Pack_info.S</a><span class="keyword"> with </span><span class="keyword">module </span><a href="../../../../Git/Pack_info/module-type-S/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Pack_info/module-type-S/Inflate/index.html">Inflate</a> := <a href="index.html#module-Inflate">Inflate</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Pack_info/module-type-S/HDec/index.html">HDec</a> := <a href="index.html#module-HDec">HDec</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../Git/Pack_info/module-type-S/PDec/index.html">PDec</a> := <a href="index.html#module-PDec">PDec</a></code></div><div class="doc"></div></div><div class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>error</code><code><span class="keyword"> = </span><a href="../index.html#type-error">error</a></code><code></code></div><div class="doc"></div></div><div class="spec val" id="val-lookup"><a href="#val-lookup" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>lookup : <a href="index.html#type-state">state</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#module-Hash">Hash</a>.t <span class="keyword">&#8209;&gt;</span> (<a href="index.html#module-Hash">Hash</a>.t<span class="keyword"> * </span>(Checkseum.Crc32.t<span class="keyword"> * </span>int64)) option Lwt.t</code></div><div class="doc"><p><code class="code">lookup state hash</code> tries to find the object associated by the hash
<code class="code">hash</code> in all <i>IDX</i> files available in the current git repository
<code class="code">state</code>. This function returns <code class="code">None</code> if the Git object does not exist in
any <i>IDX</i> files or it does not exists in the current repository.</p></div></div><div class="spec val" id="val-mem"><a href="#val-mem" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>mem : <a href="index.html#type-state">state</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#module-Hash">Hash</a>.t <span class="keyword">&#8209;&gt;</span> bool Lwt.t</code></div><div class="doc"><p><code class="code">mem state hash</code> is true iff there is an object such that <code class="code">digest(object)
      = hash</code>. This function is the same as <code class="code">lookup state hash &lt;&gt; None</code>.</p></div></div><div class="spec val" id="val-list"><a href="#val-list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>list : <a href="index.html#type-state">state</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#module-Hash">Hash</a>.t list Lwt.t</code></div><div class="doc"><p><code class="code">list state</code> is the list of all the <i>packed</i> Git object noticed by all
<i>IDX</i> files available in the current git repository <code class="code">state</code>. Errors are
ignored and skipped.</p></div></div><div class="spec val" id="val-read"><a href="#val-read" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>read : <a href="index.html#type-state">state</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#module-Hash">Hash</a>.t <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-value">value</a>, <a href="index.html#type-error">error</a>) Stdlib.result Lwt.t</code></div><div class="doc"><p><code class="code">read state hash</code> can retrieve a git <i>packed</i> object from any <i>PACK</i>
files available in the current git repository <code class="code">state</code>. It just inflates
the git object and informs some meta-data (like kind, CRC-32 check-sum,
length, etc.) about it. Then, the client can use the related decoder to
get the OCaml value.</p><p>This function allocates 2  needed to re-construct the git <i>packed</i> object in any case (if it is delta-ified or not) and a certain
amount of little buffer (sized by 0x7F bytes) to help the construction
only when the requested object is delta-ified.</p><p>Can return an <a href="index.html#type-error">error</a>:</p><ul><li><a href="FS/File/index.html#type-error">FS.File.error</a> or <a href="FS/Dir/index.html#type-error">FS.Dir.error</a> or <a href="FS/Mapper/index.html#type-error">FS.Mapper.error</a> when we
retrieve a file-system error</li><li><span class="xref-unresolved" title="unresolved reference to &quot;PACKDecoder.error&quot;">PACKDecoder.error</span> when we retrieve an
error about the decoding of the <i>packed</i> git object in the founded <i>PACK</i>i file</li><li><span class="xref-unresolved" title="unresolved reference to &quot;IDXDecoder.error&quot;">IDXDecoder.error</span> when we retrieve an error about the
decoding of an <i>IDX</i> file</li><li><code class="code">`Not_found</code> when the requested object is
not <i>packed</i></li></ul></div></div><div class="spec val" id="val-size"><a href="#val-size" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>size : <a href="index.html#type-state">state</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#module-Hash">Hash</a>.t <span class="keyword">&#8209;&gt;</span> (int, <a href="index.html#type-error">error</a>) Stdlib.result Lwt.t</code></div><div class="doc"><p><code class="code">size state hash</code> returns the size of the git <i>packed</i> object which
respects the predicate <code class="code">digest(object) = hash</code>. The size is how many
byte(s) are needed to store the serialized (but not inflated) git object
in bytes (without the header).</p><p>As for <a href="index.html#val-read">read</a>, <a href="index.html#val-size">size</a> can return an <a href="index.html#type-error">error</a>.</p></div></div><div class="spec type" id="type-stream"><a href="#type-stream" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>stream</code><code><span class="keyword"> = </span>unit <span class="keyword">&#8209;&gt;</span> Cstruct.t option Lwt.t</code><code></code></div><div class="doc"><p>The stream contains the PACK flow.</p></div></div><div class="spec val" id="val-from"><a href="#val-from" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>from : <a href="index.html#type-state">state</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-stream">stream</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#module-Hash">Hash</a>.t<span class="keyword"> * </span>int, <a href="index.html#type-error">error</a>) Stdlib.result Lwt.t</code></div><div class="doc"><p><code class="code">from git stream</code> populates the Git repository <code class="code">git</code> from the PACK flow
<code class="code">stream</code>. If any error is encountered, any Git objects of the PACK flow
are not added in the Git repository.</p></div></div><div class="spec val" id="val-make"><a href="#val-make" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make : <a href="index.html#type-state">state</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;window:[ `Object of int | `Memory of int ] <span class="keyword">&#8209;&gt;</span> ?&#8288;depth:int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-value">value</a> list <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-stream">stream</a><span class="keyword"> * </span>(Checkseum.Crc32.t<span class="keyword"> * </span>int64) <a href="Hash/index.html#module-Map">Hash.Map</a>.t Lwt_mvar.t, <a href="index.html#type-error">error</a>) Stdlib.result Lwt.t</code></div><div class="doc"><p><code class="code">make ?window ?depth values</code> makes a PACK stream from a list of
<a href="../Value/index.html#type-t">Value.t</a>.</p><p><code class="code">?window</code> specifies the weight of the window while the delta-ification.
The client can limit the weight by the number of objects in the windoz
(by default, is 10) or by the weight in byte of the window in your
memory.</p><p><code class="code">depth</code> (default is <code class="code">50</code>) limits the depth of the delta-ification.</p><p>Then, the function returns a stream and a protected variable which
contains a representation of the associated IDX file of the PACK stream.
This protected variable is available (<code class="code">Lwt_mvar.take</code>) only <b>at the
end</b> of the PACK stream. That means, the client needs to consume all of
the stream and only then he can take the <code class="code">Graph.t</code> associated.</p></div></div></body></html>