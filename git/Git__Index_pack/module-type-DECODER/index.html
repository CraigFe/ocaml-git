<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>DECODER (git.Git__Index_pack.DECODER)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">git</a></span></nav><header><h1><span class="keyword">Module type</span> <span class="module-path">Git__Index_pack.DECODER</span></h1></header><div class="doc"><p>Interface which describes the implementation of the decoder of an IDX file.</p></div><div class="spec module" id="module-Hash"><a href="#module-Hash" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Hash/index.html">Hash</a> : <a href="../../Git__/S/index.html#module-type-HASH">Git__.S.HASH</a></code></div><div class="doc"><p>The <code class="code">Hash</code> module used to make the implementation.</p></div></div><div class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>error</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-error.Invalid_byte" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_byte" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Invalid_byte</span><span class="keyword"> of </span>int</code></td><td class="doc"><p>(** Appear when we expect a specific byte and we catch another one. *)</p></td></tr><tr id="type-error.Invalid_version" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_version" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Invalid_version</span><span class="keyword"> of </span>Stdlib.Int32.t</code></td><td class="doc"><p>(** Appear when the version of the IDX file is wrong. *)</p></td></tr><tr id="type-error.Invalid_index_of_bigoffset" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_index_of_bigoffset" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Invalid_index_of_bigoffset</span><span class="keyword"> of </span>int</code></td><td class="doc"><p>(** Appear when we try to read a big offset value and we can't catch
it. *)</p></td></tr><tr id="type-error.Expected_bigoffset_table" class="anchored"><td class="def constructor"><a href="#type-error.Expected_bigoffset_table" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Expected_bigoffset_table</span></code></td><td class="doc"><p>(** Appear when we don't have a big offset table but expect one. *)</p></td></tr><tr id="type-error.Invalid_hash" class="anchored"><td class="def constructor"><a href="#type-error.Invalid_hash" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Invalid_hash</span><span class="keyword"> of </span><a href="index.html#module-Hash">Hash</a>.t<span class="keyword"> * </span><a href="index.html#module-Hash">Hash</a>.t</code></td><td class="doc"><p>(** Appear when the hash produced when we un-serialize the IDX file
does not correspond with the hash provided. *)</p></td></tr></table><code></code></div><div class="doc"><p>The error type.</p></div></div><div class="spec val" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_error : <a href="index.html#type-error">error</a> Fmt.t</code></div><div class="doc"><p>Pretty-printer of <a href="index.html#type-error">error</a>.</p></div></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"><p>The decoder state.</p></div></div><div class="spec val" id="val-pp"><a href="#val-pp" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp : <a href="index.html#type-t">t</a> Fmt.t</code></div><div class="doc"><p>Pretty-printer of the decoder <a href="index.html#type-t">t</a>.</p></div></div><div class="spec val" id="val-make"><a href="#val-make" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make : unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Make a new decoder state <a href="index.html#type-t">t</a>.</p></div></div><div class="spec val" id="val-refill"><a href="#val-refill" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>refill : int <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">refill off len t</code> provides a new <code class="code">t</code> with <code class="code">len</code> bytes to read, starting
at <code class="code">off</code>. This byte range is read by calls to <a href="index.html#val-eval">eval</a> with <code class="code">t</code> until
<code class="code">`Await</code> is returned.</p></div></div><div class="spec val" id="val-eval"><a href="#val-eval" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>eval : Cstruct.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> [ `Await of <a href="index.html#type-t">t</a> | `End of <a href="index.html#type-t">t</a><span class="keyword"> * </span><a href="index.html#module-Hash">Hash</a>.t | `Hash of <a href="index.html#type-t">t</a><span class="keyword"> * </span>(<a href="index.html#module-Hash">Hash</a>.t<span class="keyword"> * </span>Checkseum.Crc32.t<span class="keyword"> * </span>int64) | `Error of <a href="index.html#type-t">t</a><span class="keyword"> * </span><a href="index.html#type-error">error</a> ]</code></div><div class="doc"><p><code class="code">eval src t</code> is:</p><ul><li><code class="code">`Await t</code> iff <code class="code">t</code> needs more input storage. The client must use
<a href="index.html#val-refill">refill</a> to provide a new buffer and then call <a href="index.html#val-eval">eval</a> with <code class="code">`Await</code>
until other value returned.</li><li><code class="code">`End (t, hash)</code> when <code class="code">t</code> is done. We
returns the hash of the IDX file.</li><li><code class="code">`Hash (t, (hash, crc, offset))</code>
when <code class="code">t</code> can returns a new value <code class="code">(hash, crc, offset)</code>. The client can
call <a href="index.html#val-eval">eval</a> to continue the process. The value will be consumed then.</li><li><code class="code">`Error (t, exn)</code> iff the decoder meet an <a href="index.html#type-error">error</a><code class="code">exn</code>. The decoder
can't continue and sticks in this situation.</li></ul></div></div></body></html>